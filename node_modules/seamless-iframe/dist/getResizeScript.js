"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.renderResizeScript = void 0;
const constants_1 = require("./constants");
const renderResizeScript = (id, props) => {
    if (!props.heightCorrection) {
        return "";
    }
    let output = `
    const validatedMessage = () => JSON.stringify("${constants_1.POST_MESSAGE_IDENTIFIER}///${id}///${constants_1.HEIGHT_MESSAGE}///"+document.documentElement.offsetHeight);
    window.__seamlessHeightLoad = () => parent.postMessage(validatedMessage(), "${window.location.href}");
    window.addEventListener("load", window.__seamlessHeightLoad);
  `;
    if (!props.heightCorrectionOnResize) {
        return output;
    }
    if (props.debounceResizeTime) {
        output += `
        function debounce(func, wait, immediate) {
            var timeout;
            return function() {
                var context = this, args = arguments;
                var later = function() {
                    timeout = null;
                    if (!immediate) func.apply(context, args);
                };
                var callNow = immediate && !timeout;
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
                if (callNow) func.apply(context, args);
            };
        };
        window.__seamlessHeightResize = debounce(() => {
            parent.postMessage(validatedMessage(), "${window.location.href}")
        }, ${props.debounceResizeTime});
`;
    }
    else {
        output += `
        window.__seamlessHeightResize = () => {
            parent.postMessage(validatedMessage(), "${window.location.href}")
        };
    `;
    }
    return (output + `window.addEventListener("resize", window.__seamlessHeightResize);`);
};
exports.renderResizeScript = renderResizeScript;
